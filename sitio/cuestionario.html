<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>BiT Asesores</title>

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/scrolling-nav.css" rel="stylesheet">

</head>
<style type="text/css">
@font-face {
    font-family: neutra;
    src: url("fonts/neutra.otf") format("opentype");
}
@font-face {
    font-family: neutra;
    src: url("fonts/cherokee.ttf") format("truetype");
}
  .bg-primary {
    background-color: darkgrey !important;
}
.tenis{
  background: url(img/banner.png);
  background-size: 30vh;
}
.shadow{
  -webkit-box-shadow: 10px 10px 40px 0px rgba(0,0,0,0.75);
-moz-box-shadow: 10px 10px 40px 0px rgba(0,0,0,0.75);
box-shadow: 10px 10px 40px 0px rgba(0,0,0,0.75) !important;
background-color: white;
}
.shadow2{
box-shadow: 10px 10px 40px 0px rgba(0,0,0,0.15) !important;
background-color: black;
}
.cherry{
  background-color: #ffffff75;
  color:black;
}
#services{
  background: linear-gradient(to right, rgba(255,255,255,1) 0%, rgba(246,246,246,1) 47%, rgba(237,237,237,1) 100%);
}
body{
  background-color: whitesmoke;
  /*font-family: "neutra";*/
  background: url(img/banner.png);
  background-size: 30vh;
}
.gradient{
background: url(img/banner.png);
  background-size: 30vh;
    margin-top: 60px;

}
textarea{
  min-height: 250px;
  background-color: rgb(207 207 207); !important;
  border-radius: 15px;
}
input{
  background-color: rgb(207 207 207); !important;
  border-radius: 15px;
}
fresco{
  color: #007bfe;
  width: 100%;
  color:black;
  text-align: left;
}
.descripcion{
  text-align: center;
 /* background-color: rgba(0,0,0,.5);*/
}
.pregunta{
  color: black;
  
  text-align: center;
}
.respuesta{
    /*background-color: rgb(207 207 207);*/
    color: #373737;
    border: 2px solid white;
}
.respuesta2{
      /*background-color: rgb(72 92 106);*/
    color: white;
    border: 2px solid white;
}
.bg-dark{
  background-color: white !important;
      height: 70px;
}
.pregunta{
  margin:5px;
  padding:4px;
  text-align: center;
  background-color: white;
  font-size: 30pt;
  
}
.pnum{
  font-size: 30px;
  margin-left: 5px;
  cursor: pointer;
  border-bottom: 1px solid black;
  padding-left: 2px;
  padding-right: 2px;
}
.pnum:hover{
  text-decoration: underline;

}
.pnumselected{
  /*color:blue;*/
  border:1px solid grey;
}
section {
    padding: 10px 0;
}
select{
  font-size: 28px;
}
header {
     padding: 0px 0 100px !important; 
}
.whitefix{
  position:absolute;
  width:99vw;
  height:70px;
  z-index: 0;
  background-color: white;
}
.overdivtitle{

 height: 70px;
    /*width: 83%;*/
    font-size: 15pt;
    text-align: center;
    padding-top: 15px;
    /*margin-left: 8%;*/
    color:white;
}
.overdiv{
  margin-top: 70px;
  background-color: black;
  padding: 0px;
}
.overdivchild{
  padding-top:50px;
  padding-left:50px;
  padding-right:50px;
  background-color: white;
  width:100%;
  min-height:80vh;
  color:black;
  font-family: cherokee;
}
input{
  background-color: rgb(207 207 207);
  text-align: center;
}
select.respuesta{
  background-color: rgb(207 207 207) !important;
}
textarea.respuesta{
  background-color: rgb(207 207 207) !important;
}
.selectpicker{
  background-color: black;
  color:white;
  border: none;
}
.phase1{
  /*display:none;*/
}
.phase2{
  display:none;
}
.progress-bar{
  background-color: #5ea1e9 !important;
}
</style>
<body id="page-top">
  <div id="registeredname" style="display:none"></div>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" style="height: 125px;" href="https://www.bitasesores.com.mx/" target="_blank"><img style="height: 65px;margin-top: 15px;" src="img/bitlogo.png"></a>
      

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" style="color:grey;" href="#currentQ">Nosotros</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" style="color:grey;" href="#currentQ">Nuestro Proceso</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" style="color:grey;" href="#currentQ">Casos de éxito</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" style="color:grey;" href="#currentQ">Contacto</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" style="color:black;" href="#currentQ">Cuestionario</a>
          </li>
          
        </ul>
      </div>
    </div>
  </nav>
  <div class="whitefix phase1" >
    <div class="overdivtitle container" style="background-color: black;">CUESTIONARIO POTENCIALES EMPRESAS</div>

  </div>
  <div class="whitefix phase2">
    <div class="overdivtitle container" style="background-color: black;" ><select class="selectpicker" id="seccionesmenu"></select></div>
  </div>
  <header class="bg-primary text-white tenis" id="head">
    <div class="overdiv container text-center">
        
        <div class="overdivchild">
          <h3>Bienvenido a nuestro cuestionario de potenciales empresas, por medio de una serie de preguntas recopilaremos la información necesaria sobre la empresa para empezar el proceso de levantamiento de capital, el cuestionario se divide en las siguientes categorías:</h3>
          <br><br>
          <div style="text-transform: uppercase;">
            <span>A: Introducción a la compañia</span><br>
            <span>B: Información general la compañia</span><br>
            <span>C: Objetivos Estratégicos</span><br>
            <span>D: Productos y servicios</span><br>
            <span>E: Introducción a la compañia</span><br>
          </div>
          <br><br>
          <h5>El cuestionario guarda las respuestas automaticamente cada que se cambia la pregunta. Las preguntas por responder estan en color <span class="high">NEGRO</span> y las previamente respondidas en <span class="high" style="color:darkcyan;">Azúl</span></h5>
          <br>
          
          <div class="form-group">
            <!-- <label style="color:black;" for="exampleInputEmail1">Clave de acceso</label> -->
            <input type="email" class="form-control" id="claveacceso" aria-describedby="emailHelp" placeholder="Ingresa aquí tu clave de acceso">
            <br>
            <button type="button" onclick="getquest()" class="btn btn-primary">Comenzar</button>
            <!-- <small id="emailHelp" class="form-text text-muted">Copia y pega tu código de acceso.</small> -->
          </div>

        </div>
    </div>
    
  </header>

  <div class="overdiv container text-center phase2">
        
        <div class="overdivchild">
          <div class="row">
            <div class="col-lg-4"><div id="pcontainer"></div></div>
            <div class="col-lg-4">
               <span>Progreso de la sección:</span><Br>
              <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">25%</div>
              </div>
            </div> 
            <div class="col-lg-4">
              <img src="img/save.png" onclick="save()" style="width:50px;">
              <!-- <button onclick="save()">Guardar</button> -->
            </div>
          </div>
          <hr>
          
          <div id="currentQ"></div>
        </div>

  </div>      
   
 
        
  



  

  <!-- Footer -->
  <footer class="py-5 bg-dark" style="background-color: black !important;">
    <div class="container" >
      <p class="m-0 text-center text-white">  &copy; BiT Asesores </p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <!-- Plugin JavaScript -->
  <script src="js/jquery.easing.min.js"></script>

  <!-- Custom JavaScript for this theme -->
  <script src="js/scrolling-nav.js"></script>

</body>

<script type="text/javascript">

var _MENU={};
$(document).ready(function(){
  console.log("READY")

   
  
  //getMenu()
});

function getMenu(){

  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {

      var myObj = JSON.parse(this.responseText);
      _MENU=myObj.cuestionario;
      console.log(_MENU)
      for(secc in _MENU){
          $("#seccionesmenu").append('<option>'+secc+'</option>');
          
        }

      refresh()
        despliegaQ("A: Introducción a la compañía",0);
        gotoQ(0)
      
      }
  };
  xmlhttp.open("GET", "/menu", true);
  xmlhttp.send();
}
$( "#seccionesmenu" ).change(function() {
  refresh();
  gotoQ(0)
});
function refresh(){
  seccion=$( "#seccionesmenu option:selected" ).text();
  counter=0;
  total=0;
  for(i=0;i<_MENU[seccion].length;i++){
    total+=1;
    if (_MENU[seccion][i].respuesta){
      counter+=1;
    }
  }
  $(".progress-bar").attr("style","width: "+(counter*100/total)+"%" );
  $(".progress-bar").html( Math.round(counter*100/total)+"%" );
  console.log("progress",counter/total,_MENU[seccion]);
  console.log(seccion,"---")
  $("#pcontainer").html("");
  respind=""
  for (var i = 0; i < _MENU[seccion].length; i++){
      if(_MENU[seccion][i].respuesta){
        respind='style="color:darkcyan;"'
      }
      else{
        respind=''
      }
            $("#pcontainer").append('<span class="pnum" '+respind+' num="'+i+'" onclick="gotoQ('+i+')">  '+i+'  </span>')
  }
}
function gotoQ(i){
  $(".pnum").removeClass("pnumselected")
  
  seccion=$( "#seccionesmenu option:selected" ).text();
  refresh();
  $(".pnum[num='"+i+"']").addClass("pnumselected");
   despliegaQ(seccion,i)
   save();
}
function despliegaQ(sec,num){
  idlab=sec.split(":");
  quest=typestr(_MENU[sec][num],idlab[0]+"-"+num,sec+"|"+num);
  object='    <div class="container" >\
      <h1 style="color:black;" class="pregunta">'+_MENU[sec][num].texto+'</h1>\
      <div class="row respuesta2"  style="color: darkgrey;padding:15px;">\
        <div class="col-lg-12 mx-auto">'+quest+
        '</div>\
      </div>\
      <div class="row descripcion"  style="color: black;padding:15px;">\
        <fresco>'+_MENU[sec][num].desc+'</fresco>\
      </div>  \
    </div>';
    $("#currentQ").html(object);
    if(_MENU[sec][num].respuesta){
      makeRespuesta(idlab[0]+"-"+num,_MENU[sec][num].type,_MENU[sec][num])
    }
    
}
function typestr(objeto,id,label){
  Rstr="";
  if(objeto.type=="select"){
    Rstr+='<select name="cars" label="'+label+'" id="'+id+'" class="form-control respuesta select">';
    for (var i = 0; i < objeto.vals.length; i++) {
      console.log(objeto.vals[i])
      Rstr+='<option class="" value="'+objeto.vals[i].toLowerCase()+'">'+objeto.vals[i].toUpperCase()+'</option>';
    }
    Rstr+='</select>';
  }
  if(objeto.type=="open"){
    Rstr+='Escribe Respuesta aquí:<Br><textarea label="'+label+'" id="'+id+'" class="form-control respuesta open"></textarea>';
  }
  if(objeto.type=="opcional"){
    Rstr+='Responder sólo si se cuenta con la información:<Br><textarea label="'+label+'" id="'+id+'" class="form-control respuesta opcional"></textarea>';
  }
  if(objeto.type=="num"){
    Rstr+='Escribe el número aquí:<Br><input type="text" label="'+label+'" id="'+id+'" name="" class="num respuesta"></input>';
  }
  if(objeto.type=="table"){
    Rstr+='Añade la información en la tabla:<Br>';
    head='<table class="table respuesta" label="'+label+'" id="'+id+'">\
        <thead>\
          <tr>'
          
    for (var i = 0; i < objeto.vals.length; i++) {
      head+='<th scope="col">'+objeto.vals[i]+'</th>'
    }
    head+='</tr></thead>';
    body='  <tbody>';
    for (var i = 0; i < 3; i++) {
      body+='<tr>'
      for (var j = 0; j < objeto.vals.length; j++) {
        body+='<td><input type="text" name="'+i+"-"+j+'"></td>';
      }
      body+='</tr>';
    }
    body+='</table>';
    body+='<button type="button" onclick="addrow(\''+id.trim()+'\')" class="btn btn-primary">Añadir renglón</button>';
    Rstr+=head+body;
  }
  
  return Rstr;
}
function addrow(id){
  
  numcols=$("#"+id).find("tr:nth-child(1) td").length;
  console.log("num",id,numcols)
  htmlrow="<tr>";
  for (var i = 0; i < numcols; i++) {
    htmlrow+='<td><input type="text" name=""></td>'
  }
  htmlrow+="</tr>";
  console.log(htmlrow)
  $("#"+id).append(htmlrow);
}
function makeRespuesta(id,type,elemento){
  respuesta=elemento.respuesta;
  htmltable="";
  if(type=="table"){
    console.log("table",respuesta)
    head='<tr>'
          
    for (var i = 0; i < elemento.vals.length; i++) {
      head+='<td scope="col">'+elemento.vals[i]+'</td>'
    }
    head+='</tr>';
    for(i=0;i<respuesta.length;i++){
      htmltable+="<tr>";
      for(j=0;j<respuesta[i].length;j++){
        htmltable+='<td><input type="text" name="'+i+"-"+j+'" value="'+respuesta[i][j]+'"></td>';
      }
      htmltable+="</tr>";
    }
    $("#"+id).html(head+htmltable);
  }
  else{
    $("#"+id).val(respuesta);
  }
}
function getquest(){
  name=$("#claveacceso").val();
  $("#registeredname").html(name);
  $.ajax({
        url: '/menu',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({"name":name}),
        dataType: 'json',
        error: function(xhr, status, error) {
          console.log(xhr, status, error);
          $("#console").html("No se pudo salvar");
          //alert(xhr.responseText);
        },
        success: function (data){
          $(".phase1").hide();
        $(".phase2").show();
          console.log("data",data)
          _MENU=data;
          //console.log(_MENU)
          for(secc in _MENU){
              $("#seccionesmenu").append('<option>'+secc+'</option>');
              
            }
            refresh()
            despliegaQ("A: Introducción a la compañía",0);
            gotoQ(0)
          
        }
    });
  hidepass();
}
function hidepass(){
  $("#head").hide("slow");
}
respcount=0;

$(document).on('change', '.respuesta', function () {
    vv=$(this).val();
    element=$(this);
    console.log("change",vv);
    if(element.is("table")){
      updateTable(element);
    }
    else{
      updateAwnser(element,vv);
    }
    refresh()
});
function updateAwnser(element, vv){
  console.log(element.attr("label"));
  id=element.attr("label");
  ids=id.split("|");
  console.log(ids)
  _MENU[ids[0]][ids[1]]["respuesta"]=vv;
  pregunta=_MENU[ids[0]][ids[1]];

  console.log("pregunta",pregunta)

}
function updateTable(element){
  console.log(element.attr("label"));
  id=element.attr("label");
  ids=id.split("|");
  console.log(ids)
  tableobj=[];
  element.find('tr').each(function (i, row) {
    rowobj=[]
    $(row).find('input').each(function (j, inp) {
      rowobj.push($(inp).val());
    })
    tableobj.push(rowobj);
  });
  _MENU[ids[0]][ids[1]]["respuesta"]=tableobj;
  pregunta=_MENU[ids[0]][ids[1]];
  console.log("pregunta table",pregunta)

}
function save(){
  name2save=$("#registeredname").html();
  $.ajax({
        url: '/saveprogress',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({"name":name2save,"cuestionario":_MENU}),
        dataType: 'json',
        error: function(xhr, status, error) {
          console.log(xhr, status, error);
          $("#console").html("No se pudo salvar");
          //alert(xhr.responseText);
        },
        success: function (data){
          console.log("data")
          
          
        }
    });
}
function reset(){
  console.log(_MENU);
  name2save=$("#registeredname").html("new");
  for (seccion in _MENU){
    for(i=0;i<_MENU[seccion].length;i++){
      _MENU[seccion][i].respuesta="";
    }
  }
  save();
}
</script>
</html>
